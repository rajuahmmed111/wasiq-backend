// datasource and generator setup
datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

// ---------------------------------------------------------
//  ENUMS
// ---------------------------------------------------------

enum UserRole {
  USER
  AGENT
  ADMIN
  SUPER_ADMIN
}

enum UserStatus {
  ACTIVE
  INACTIVE
  REJECTED
}

enum ServiceType {
  BY_THE_HOUR
  DAY_TRIP
  MULTI_DAY_TOUR
  PRIVATE_TRANSFER
  AIRPORT_TRANSFER
}

enum RouteType {
  CITY_TO_CITY
  AIRPORT_TRANSFER
  MULTI_DAY
}

enum EveryServiceStatus {
  AVAILABLE
  BOOKED
}

enum ServiceStatus {
  ACTIVE
  INACTIVE
}

enum PaymentStatus {
  PAID
  UNPAID
  REFUNDED
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
  EXPIRED
}

enum PaymentProvider {
  STRIPE
}

enum PromoStatus {
  ACTIVE
  INACTIVE
  EXPIRED
}

enum SupportType {
  Critical
  High
  Medium
  Low
}

enum SupportStatus {
  Pending
  Closed
}

// ---------------------------------------------------------
//  MODEL
// ---------------------------------------------------------

model User {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  fullName        String?
  email           String     @unique
  password        String     @default("123456")
  profileImage    String     @default("https://i.ibb.co/Ps9gZ8DD/Profile-image.png")
  contactNumber   String?
  dateOfBirth     DateTime?
  address         String?
  country         String?
  role            UserRole   @default(USER)
  status          UserStatus @default(ACTIVE)
  fcmToken        String?    @default("")
  isEmailVerified Boolean    @default(false)
  isPhoneVerified Boolean    @default(false)

  // Stripe
  stripeAccountId   String?
  isStripeConnected Boolean @default(false)

  // notification Preferences
  supportNotification Boolean @default(true)
  paymentNotification Boolean @default(true)
  emailNotification   Boolean @default(true)

  otp        String?
  otpExpiry  DateTime?
  identifier String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // relationships
  payment       Payment[]
  notifications Notifications[]
  review        Review[]
  favorite      Favorite[]
  sender        Channel[]       @relation("ChannelPerson1")
  receiver      Channel[]       @relation("ChannelPerson2")
  messages      Message[]       @relation("sentMessages")
  support       Support[]
  tripServices  TripService[]

  @@map("users")
}

model Admin {
  id          String  @id @default(auto()) @map("_id") @db.ObjectId
  fullName    String?
  phoneNumber String?
  email       String  @unique
  password    String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("admins")
}

model TripService {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  from              String?
  fromLat           Float?
  fromLng           Float?
  to                String?
  toLat             Float?
  toLng             Float?
  price             Float?
  travelTimeMinutes Int?
  distanceKm        Float?
  groupType         String
  images            String[]
  description       String
  serviceType       ServiceType
  routeType         String?
  tourDays          Int?
  isPopular         Boolean            @default(false)
  bookingCount      Int                @default(0)
  features          Json?
  ratings           Float              @default(0)
  reviewCount       Int                @default(0)
  isService         EveryServiceStatus @default(AVAILABLE)
  status            ServiceStatus      @default(ACTIVE)
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt

  // relations
  user      User       @relation(fields: [userId], references: [id])
  userId    String     @db.ObjectId
  stoppages Stoppage[]

  @@map("trip_services")
}

model Stoppage {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  name        String   @unique
  type        String
  price       Float
  duration    Int? // minutes
  description String?
  image       String[]
  latitude    Float
  longitude   Float
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // relationships
  tripServiceId String?      @db.ObjectId
  tripService   TripService? @relation(fields: [tripServiceId], references: [id])

  @@map("stoppages")
}

model Vehicle {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  name        String // Sedan, Compact MPV, Van, Luxury Sedan
  seatCount   Int
  luggage     Int
  basePrice   Float
  pricePerKm  Float?
  image       String[]
  plateNumber String?
  isActive    Boolean  @default(true)
  // driverName  String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("vehicles")
}

model Review {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  rating     Float
  subRatings Json?
  comment    String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  // relationships
  user   User   @relation(fields: [userId], references: [id])
  userId String @db.ObjectId

  @@map("reviews")
}

model Blog {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  title     String
  content   String
  category  String
  image     String[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("blogs")
}

model Favorite {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  user      User     @relation(fields: [userId], references: [id])
  userId    String   @db.ObjectId
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("favorites")
}

model Notifications {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  receiverId   String?  @db.ObjectId
  partnerId    String?  @db.ObjectId
  supportId    String?  @db.ObjectId
  title        String
  message      String?
  body         String
  serviceTypes String?
  bookingId    String?
  read         Boolean  @default(false)
  isClicked    Boolean  @default(false)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  user         User?    @relation(fields: [receiverId], references: [id])

  @@map("notifications")
}

model Faq {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  question  String
  answer    String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("faqs")
}

model CustomerContact {
  id          String  @id @default(auto()) @map("_id") @db.ObjectId
  fullName    String
  email       String
  phone       String?
  description String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("customer_contacts")
}

model Cancel_Reservation {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  description String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("cancel_reservations")
}

model Refund_Policy {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  description String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("refund_policies")
}

model About_App {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  description String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("about_apps")
}

model Terms_Condition {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  description String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("terms_conditions")
}

model Privacy_Policy {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  description String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("privacy_policies")
}

model Channel {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  channelName String   @unique
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  //Relations
  person1Id String?   @db.ObjectId
  person1   User?     @relation("ChannelPerson1", fields: [person1Id], references: [id])
  person2Id String?   @db.ObjectId
  person2   User?     @relation("ChannelPerson2", fields: [person2Id], references: [id])
  messages  Message[]

  @@map("channels")
}

model Message {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  message   String?
  files     String[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  senderId    String   @db.ObjectId
  sender      User     @relation("sentMessages", fields: [senderId], references: [id])
  channelName String
  Channel     Channel? @relation(fields: [channelName], references: [channelName])

  @@map("messages")
}

model Payment {
  id               String          @id @default(auto()) @map("_id") @db.ObjectId
  amount           Float
  description      String?
  currency         String?
  sessionId        String?         @unique
  paymentMethod    String?
  status           PaymentStatus
  // status           String
  provider         PaymentProvider
  payable_name     String?
  payable_email    String?
  payment_intent   String?
  country          String?
  admin_commission Float?
  service_fee      Float?
  paystack_fee     Float?
  vat_amount       Float? // 5% only for admin
  transactionId    String?
  serviceType      String // HOTEL | SECURITY | CAR | ATTRACTION
  partnerId        String          @db.ObjectId
  isDeleted        Boolean         @default(false)
  metadata         Json? // extra(fullName, email, contactNumber, country, description etc).

  // Relations
  user   User   @relation(fields: [userId], references: [id])
  userId String @db.ObjectId

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("payments")
}

model Support {
  id            String        @id @default(auto()) @map("_id") @db.ObjectId
  fullName      String?
  email         String?
  contactNumber String?
  subject       String
  description   String
  supportType   SupportType   @default(High)
  status        SupportStatus @default(Pending)
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt

  // Relations
  user   User?   @relation(fields: [userId], references: [id])
  userId String? @db.ObjectId

  @@map("supports")
}
